<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.used.example.mapper.ProductMapper">
	<insert id="createProduct" parameterType="com.used.example.domain.Product">
		insert into product ( 
		
								u_username,
								p_kind,
								p_industry,
								p_brand,
								p_year,
								p_startprice,
								p_endprice,
								p_title,
								p_content,
								p_sale,
								p_address
		
		) values (				
		
								#{username},
								#{kind},
								#{industry},
								#{brand},
								#{year},	
								#{startprice},
								#{endprice},
								#{title},
								#{content},
								#{sale},
								#{address}
		)
		
		<selectKey resultType= "int" keyProperty="p_num" order="AFTER" >
			select last_insert_id()
		</selectKey>
	</insert>
	<insert id= "createPicture" parameterType= "com.used.example.domain.Picture">
			insert into picture(
				p_num,
				pi_name
			) values
					<foreach collection="pictureNames" item="list" separator=" , ">
					(#{p_num}, #{list})
					</foreach>
	</insert>
	
	<resultMap type="Picture" id="PictureMap">
		<result property="pictureName" column="pi_name" />
	</resultMap>
	
	<resultMap id="ProductMap" type="Product">
		<id property= "p_num" column= "p_num" />
		<result property= "p_num" column= "p_num" />
		<result property= "username" column= "u_username" />
		<result property= "title" column= "p_title" />
		<result property= "p_date" column= "p_date" />
		<collection property="picture" resultMap="PictureMap"></collection>
	</resultMap>
	
	
	<select id= "getSaleList" parameterType="String" resultMap= "ProductMap">	
		SELECT			a.p_num, 				
						a.u_username,			
						a.p_title,			
						a.p_date,				
						b.pi_name				
		FROM			product a
		LEFT JOIN	    picture b ON a.p_num = b.p_num
		WHERE 		    u_username= #{username}
		AND             a.p_sale='false'
	</select>
	<select id= "getSoldList" parameterType="String" resultMap= "ProductMap">	
		SELECT			a.p_num, 				
						a.u_username,		
						a.p_title,				
						a.p_date,			
						b.pi_name				
		FROM			product a
		LEFT JOIN	    picture b ON a.p_num = b.p_num
		WHERE 		    u_username= #{username}
		AND             a.p_sale='true'
	</select>		
	
	
	
	
	<select id= "getSaleDetail" parameterType= "int" resultType= "com.used.example.domain.Product">
		SELECT 	a.p_num 				as p_num,
				a.u_username			as username,
				a.p_kind				as kind,
				a.p_industry 			as industry,
				a.p_brand				as brand,
				a.p_year				as year,
				a.p_startprice		  	as startprice,
				a.p_title				as title,
				a.p_content				as content,
				a.p_sale				as sale,
				a.p_date				as p_date,
				(SELECT GROUP_CONCAT(p_picture SEPARATOR ',')
						FROM  picture b
						WHERE b.p_num = #{p_num})p_picture
		FROM   product a
		WHERE  a.p_num = #{p_num}		
	</select>
	<select id= "getAuction" parameterType= "int" resultType= "com.used.example.domain.Auction">
		SELECT 	u_name 					as participant,
				p_num					as p_num,
				a_price					as price,
				a_time					as aTime
		FROM    auction
		WHERE   p_num = #{p_num}				
		ORDER BY  a_price DESC
 	</select>
	



</mapper>